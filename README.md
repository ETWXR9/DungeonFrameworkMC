## 介绍
挖坑中。
* 这是一个可以在mc服务器中实现房间副本游戏方式的Spigot插件。
* 通过在世界中预制好封闭房间、将同一房间复制多个副本，来实现多玩家同时体验独立的游戏流程，而不会冲突。
* 插件提供lua脚本功能，可自行实现lua脚本、动态加载/卸载lua逻辑。从而自由搭建roguelike、团队副本、pvp、小游戏等副本式游戏玩法。
* 在lua脚本中，用户可以操作副本游戏流程，创建UI和按钮，生成物品、实体等，目前还在进一步添加逻辑。且用户可在lua中利用luaJ的功能直接创建和操作java对象实例。
* 副本房间编辑功能，完成度90%。
* ~~游戏逻辑和游戏内容 1%~~ 已经移除
* lua配置功能 30%

## 地牢副本编辑
* /rl createdungeon id \<dungeon x> \<y> \<z> \<room x> \<y> \<z> \<tags...> 该指令可创建一虚空世界，按照第一个三维坐标设定地牢房间容量，第二个坐标设定单个房间的大小。同时会将玩家传送到该地牢的默认房间中。

* 地牢信息包括Id（与所在虚空世界同名） 标签 容量 房间尺寸

* 通过各种指令，可以在地牢中创建房间、设置房间信息、复制房间、将单个房间的内容应用到其所有复制中去。以及删除房间。

* 房间信息包括Id 标签 玩家位置 特殊位置。特殊位置使用Map储存，键为坐标，值为Id

* 所有这些数据存在插件配置目录下，地牢和房间信息分开存放，运行时通过目录名称相匹配。

## 地牢游戏机制
* 通过指令，游戏为特定玩家创建一份地牢游戏流程（DungeonTour实例），该流程包括其中的玩家列表、当前所在房间以及所有加载的lua等信息。

* 玩家通过传送来在不同的房间中移动，设计上tour同一时刻只能有一个当前房间，因此传送API会同时传送tour中的所有玩家。

* 所有lua都在每个DungeonTour实例创建的独立lua环境中运行，每多一个DungeonTour都会创建一个新的lua全局环境。因此lua脚本可以存储本地变量而不会产生冲突。


## lua脚本功能
* 插件的lua脚本存放在配置目录下多个不同位置。

* lua分三类：全局、动态、房间。全局指的是tour初始化时就加载的lua，tour结束之前始终加载；动态lua是tour初始化时不加载，必须通过调用API加载的lua脚本，也可以中途卸载；房间lua是一类特殊的动态lua，它在tour更换房间时自动加载和卸载，不可手动控制。

* 由于lua都在同一个环境之下，因此不得存在重名lua脚本。

* 所有lua脚本通过两种方式执行逻辑：一是在其被加载时，调用其init()函数、在其被卸载时，调用其close()函数；二是通过API订阅事件，将自身的function变量添加入订阅列表，服务器事件发生时就会执行，lua卸载时自动注销其订阅。

* 本插件使用luaj作为脚本引擎。插件提供一个LuaAPI类供所有lua直接使用，包装了一些较为常用的函数。用户也可以直接使用luajava.newInstance来创建任意java对象。luaj在编写lua时有一些规则，例如lua在调用java函数时必须使用冒号而不是点（如LuaAPI:PlayerSendMessage(player,"msg")），而由java调用的lua函数在声明时则不能使用冒号(如function MyLua.MyFunc(arg))。